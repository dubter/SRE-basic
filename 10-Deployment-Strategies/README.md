# Домашнее задание №10 "Стратегии деплоя"

## 1 задание
На практике посмотреть, как происходят разные варианты деплоя приложения.

Пример команды, для генерации трафика в minikube, можно использовать любые утилиты для генерации трафика

```
$ service=$(minicube service oncall --url)
$ while sleep 0.1; do curl $service; done
```

В домашнем задании необходимо:

Предоставить видеозапись с разными стратегиями деплоя (Recreate, Rolling Update, Blue/Green, Canary) с выводом обработки трафика в grafana, как в примерах на семинаре
Приложить исходники Deployment манифеста


> [!NOTE]
> **Критерии оценки**:
> * 6 баллов - видеозапись с Recreate и Rolling Update
> * 4 балла - видеозапись с Blue/Green or Canary Rollout or Canary Release, из коробки кубернетес не поддерживает их в автоматическом режиме. Поэтому помимо видео, нужно описать шаги действий, чтобы выполнить такое развертывание приложения стандартными средствами миникуба

### Решение

Recreate strategy - сначала поды удаляются и потом создаются новые - так делать плохо в проде.

Rolling strategy - постепенно под за подом меняют друг друга причем сначала содается новый а потом удаляется старый под.

Canary Release — это развертывание, при котором новая версия приложения развертывается только для небольшой группы пользователей, чтобы минимизировать риски. Например, можно обновить только 1 Pod из 3 на новую версию.

В моем примере: создаем 2 деплоймента: `demo` и `demo-canary` с ОДИНАКОВЫМ `label app: demo`. И направляем на них сервис. Далее постепенно увеличиваем количество реплик у `demo-canary` и уменьшаем у `demo`.

Для Blue/Green деплоя Kubernetes требует настройки двух разных репликаций: одна будет работать как `"Blue"` (текущая версия), другая как `"Green"` (новая версия).

В моем примере: деплоймент demo переключаем на `demo-blue` меняя в Service selector на `app: demo-blue`.